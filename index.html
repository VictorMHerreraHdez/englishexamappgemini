<!DOCTYPE html>
<html lang="es" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen de Evaluación de Inglés</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <style>
        body { font-family: sans-serif; }
        .dark { background-color: #1a202c; color: #f7fafc; }
        .question-container { display: none; }
        .question-container.active { display: block; }
        .answer-option { cursor: pointer; }
        .feedback-correct { color: green; }
        .feedback-incorrect { color: red; }
        .summary-table th, .summary-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        #results-container { display: none; }
        .lazy-load { opacity: 0; transition: opacity 0.5s ease-in-out; }
        .lazy-load.loaded { opacity: 1; }
        /* Estilos de accesibilidad */
        .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
        .contrast-normal { filter: none; }
        .contrast-high { filter: contrast(175%); }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
    <div class="container mt-5 p-4 bg-white dark:bg-gray-800 rounded shadow-md">
        <h1 class="text-2xl font-bold mb-4 text-center">Evaluación de Inglés</h1>

        <div id="exam-container">
            <div id="timer" class="alert alert-info text-center mb-3">Tiempo restante: <span id="time-left"></span></div>
            <form id="quiz-form">
                <div id="questions-container">
                    </div>
                <button type="submit" class="btn btn-primary mt-4" id="submit-quiz">Finalizar Examen</button>
            </form>
        </div>

        <div id="results-container" class="mt-5" style="display: none;">
            <h2 class="text-xl font-semibold mb-3 text-center">Resultados del Examen</h2>
            <div id="summary" class="mb-4">
                <table class="table table-bordered summary-table">
                    <thead>
                        <tr>
                            <th>Total de Preguntas</th>
                            <th>Aciertos</th>
                            <th>Errores</th>
                            <th>Nivel</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="total-questions-summary"></td>
                            <td id="correct-answers-summary"></td>
                            <td id="incorrect-answers-summary"></td>
                            <td id="level-summary"></td>
                        </tr>
                    </tbody>
                </table>
                <div class="d-flex justify-content-center">
                    <canvas id="results-chart" width="200" height="200"></canvas>
                </div>
            </div>

            <div id="motivational-message" class="alert alert-success text-center mb-3"></div>

            <form id="user-info-form" class="mb-4">
                <h3 class="text-lg font-semibold mb-2">Información Adicional</h3>
                <div class="mb-3">
                    <label for="full-name" class="form-label">Nombre Completo:</label>
                    <input type="text" class="form-control" id="full-name" required>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Correo Electrónico:</label>
                    <input type="email" class="form-control" id="email" required>
                </div>
                <button type="button" class="btn btn-outline-secondary me-2" onclick="sendResultsViaEmail()">Enviar resultados por correo</button>
                <button type="button" class="btn btn-outline-primary me-2" onclick="downloadResultsCSV()">Descargar CSV</button>
                <button type="button" class="btn btn-outline-info" onclick="downloadChartPNG()">Descargar Gráfico</button>
            </form>
        </div>

        <div class="fixed bottom-4 right-4 space-x-2">
            <button id="theme-toggle" class="bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full p-2 shadow-md">
                <i id="theme-icon" class="fas fa-sun"></i>
            </button>
        </div>
    </div>

    <script>
        const questionsData = [
            {
                type: 'text',
                question: 'Choose the correct verb conjugation: I _____ to the park yesterday.',
                options: ['go', 'went', 'gone', 'going'],
                correctAnswer: 'went'
            },
            {
                type: 'image',
                question: 'What is this animal?',
                imageSrc: 'https://via.placeholder.com/100/FFC107/000000?Text=Cat', // Placeholder URL
                options: ['Dog', 'Cat', 'Bird', 'Fish'],
                correctAnswer: 'Cat'
            },
            {
                type: 'text',
                question: 'Select the synonym for "happy".',
                options: ['Sad', 'Angry', 'Joyful', 'Tired'],
                correctAnswer: 'Joyful'
            },
            {
                type: 'audio',
                question: 'Listen to the audio and choose the correct word.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Ship', 'Sheep'],
                correctAnswer: 'Sheep'
            },
            {
                type: 'text',
                question: 'Complete the sentence: She is _____ a book.',
                options: ['read', 'reads', 'reading', 'to read'],
                correctAnswer: 'reading'
            },
            {
                type: 'image',
                question: 'Identify the fruit shown in the picture.',
                imageSrc: 'https://via.placeholder.com/100/28A745/FFFFFF?Text=Apple', // Placeholder URL
                options: ['Banana', 'Apple', 'Orange', 'Grapes'],
                correctAnswer: 'Apple'
            },
            {
                type: 'text',
                question: 'What is the opposite of "big"?',
                options: ['Large', 'Huge', 'Small', 'Giant'],
                correctAnswer: 'Small'
            },
            {
                type: 'audio',
                question: 'Choose the number you hear.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Three', 'Free'],
                correctAnswer: 'Three'
            },
            {
                type: 'text',
                question: 'They _____ playing football now.',
                options: ['is', 'are', 'am', 'be'],
                correctAnswer: 'are'
            },
            {
                type: 'image',
                question: 'Recognize the vehicle.',
                imageSrc: 'https://via.placeholder.com/100/007BFF/FFFFFF?Text=Car', // Placeholder URL
                options: ['Bike', 'Car', 'Bus', 'Train'],
                correctAnswer: 'Car'
            },
             {
                type: 'text',
                question: 'Which of these is a vowel?',
                options: ['B', 'C', 'E', 'D'],
                correctAnswer: 'E'
            },
            {
                type: 'image',
                question: 'What color is this?',
                imageSrc: 'https://via.placeholder.com/50/0000FF/FFFFFF?Text=Blue', // Placeholder URL
                options: ['Red', 'Blue', 'Green', 'Yellow'],
                correctAnswer: 'Blue'
            },
            {
                type: 'text',
                question: 'The plural of "child" is:',
                options: ['childs', 'children', 'childes', 'childre'],
                correctAnswer: 'children'
            },
            {
                type: 'audio',
                question: 'Listen and select the animal sound.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Meow', 'Woof', 'Tweet', 'Roar'],
                correctAnswer: 'Meow'
            },
            {
                type: 'text',
                question: 'He _____ a doctor.',
                options: ['am', 'is', 'are', 'be'],
                correctAnswer: 'is'
            },
            {
                type: 'image',
                question: 'Identify the piece of clothing.',
                imageSrc: 'https://via.placeholder.com/100/6C757D/FFFFFF?Text=Shirt', // Placeholder URL
                options: ['Pants', 'Shirt', 'Shoes', 'Hat'],
                correctAnswer: 'Shirt'
            },
            {
                type: 'text',
                question: 'Choose the adverb that modifies "runs": He runs _____ .',
                options: ['quick', 'quicker', 'quickly', 'quickest'],
                correctAnswer: 'quickly'
            },
            {
                type: 'audio',
                question: 'Select the day of the week you hear.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Monday', 'Sunday'],
                correctAnswer: 'Sunday'
            },
            {
                type: 'text',
                question: 'We _____ to the cinema last night.',
                options: ['go', 'went', 'gone', 'going'],
                correctAnswer: 'went'
            },
            {
                type: 'image',
                question: 'What is this?',
                imageSrc: 'https://via.placeholder.com/100/17A2B8/FFFFFF?Text=Book', // Placeholder URL
                options: ['Pencil', 'Book', 'Eraser', 'Ruler'],
                correctAnswer: 'Book'
            },
            {
                type: 'text',
                question: 'The opposite of "hot" is:',
                options: ['Warm', 'Cold', 'Cool', 'Boiling'],
                correctAnswer: 'Cold'
            },
            {
                type: 'audio',
                question: 'Pick the correct color.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Red', 'Green'],
                correctAnswer: 'Green'
            },
            {
                type: 'text',
                question: 'She _____ English very well.',
                options: ['speak', 'speaks', 'speaking', 'to speak'],
                correctAnswer: 'speaks'
            },
            {
                type: 'image',
                question: 'Recognize the transportation.',
                imageSrc: 'https://via.placeholder.com/100/DC3545/FFFFFF?Text=Bus', // Placeholder URL
                options: ['Car', 'Bus', 'Train', 'Plane'],
                correctAnswer: 'Bus'
            },
            {
                type: 'text',
                question: 'Which is a type of weather?',
                options: ['Table', 'Chair', 'Rain', 'Computer'],
                correctAnswer: 'Rain'
            },
            {
                type: 'audio',
                question: 'Choose the correct verb form.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Eat', 'Ate'],
                correctAnswer: 'Ate'
            },
            {
                type: 'text',
                question: 'They _____ happy to see you.',
                options: ['is', 'am', 'are', 'be'],
                correctAnswer: 'are'
            },
            {
                type: 'image',
                question: 'Identify the drink.',
                imageSrc: 'https://via.placeholder.com/100/008000/FFFFFF?Text=Tea', // Placeholder URL
                options: ['Coffee', 'Tea', 'Juice', 'Water'],
                correctAnswer: 'Tea'
            },
            {
                type: 'text',
                question: 'The superlative of "good" is:',
                options: ['better', 'goodest', 'best', 'more good'],
                correctAnswer: 'best'
            },
            {
                type: 'audio',
                question: 'Select the correct animal.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Lion', 'Tiger'],
                correctAnswer: 'Lion'
            },
            {
                type: 'text',
                question: 'He _____ playing the guitar.',
                options: ['like', 'likes', 'liking', 'to like'],
                correctAnswer: 'likes'
            },
            {
                type: 'image',
                question: 'Recognize the musical instrument.',
                imageSrc: 'https://via.placeholder.com/100/800080/FFFFFF?Text=Piano', // Placeholder URL
                options: ['Guitar', 'Piano', 'Violin', 'Drums'],
                correctAnswer: 'Piano'
            },
            {
                type: 'text',
                question: 'What is the past participle of "see"?',
                options: ['saw', 'seeing', 'seen', 'sees'],
                correctAnswer: 'seen'
            },
            {
                type: 'audio',
                question: 'Choose the correct preposition.',
                audioSrc: '#', // Placeholder for audio source
                options: ['On', 'In'],
                correctAnswer: 'In'
            },
            {
                type: 'text',
                question: 'We _____ going to the beach tomorrow.',
                options: ['is', 'am', 'are', 'be'],
                correctAnswer: 'are'
            },
            {
                type: 'image',
                question: 'Identify the body part.',
                imageSrc: 'https://via.placeholder.com/50/A020F0/FFFFFF?Text=Eye', // Placeholder URL
                options: ['Ear', 'Eye', 'Nose', 'Mouth'],
                correctAnswer: 'Eye'
            },
            {
                type: 'text',
                question: 'The comparative of "tall" is:',
                options: ['taller', 'tallest', 'more tall', 'tallly'],
                correctAnswer: 'taller'
            },
            {
                type: 'audio',
                question: 'Select the correct action.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Run', 'Ran'],
                correctAnswer: 'Run'
            },
            {
                type: 'text',
                question: 'She _____ a new car last week.',
                options: ['buy', 'buys', 'bought', 'buying'],
                correctAnswer: 'bought'
            },
            {
                type: 'image',
                question: 'Recognize the furniture.',
                imageSrc: 'https://via.placeholder.com/100/4B0082/FFFFFF?Text=Chair', // Placeholder URL
                options: ['Table', 'Chair', 'Bed', 'Sofa'],
                correctAnswer: 'Chair'
            },
            {
                type: 'text',
                question: 'What is the adverb of "careful"?',
                options: ['carefully', 'carefuly', 'more careful', 'carefullest'],
                correctAnswer: 'carefully'
            },
            {
                type: 'audio',
                question: 'Choose the correct adjective.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Happy', 'Happily'],
                correctAnswer: 'Happy'
            },
            {
                type: 'text',
                question: 'I _____ very tired today.',
                options: ['is', 'are', 'am', 'be'],
                correctAnswer: 'am'
            },
            {
                type: 'image',
                question: 'Identify the tool.',
                imageSrcoptions: ['Screwdriver', 'Hammer', 'Wrench', 'Pliers'],
                correctAnswer: 'Hammer'
            },
            {
                type: 'text',
                question: 'The opposite of "easy" is:',
                options: ['Simple', 'Hard', 'Difficult', 'Effortless'],
                correctAnswer: 'Hard'
            },
            {
                type: 'audio',
                question: 'Select the correct noun.',
                audioSrc: '#', // Placeholder for audio source
                options: ['Run', 'Runner'],
                correctAnswer: 'Runner'
            },
            {
                type: 'text',
                question: 'They _____ arrived at the station.',
                options: ['has', 'have', 'is', 'are'],
                correctAnswer: 'have'
            },
            {
                type: 'image',
                question: 'Recognize the plant.',
                imageSrc: 'https://via.placeholder.com/100/00FF00/FFFFFF?Text=Tree', // Placeholder URL
                options: ['Flower', 'Tree', 'Grass', 'Bush'],
                correctAnswer: 'Tree'
            },
            {
                type: 'text',
                question: 'What is the agent noun of "teach"?',
                options: ['teaches', 'teaching', 'teacher', 'taught'],
                correctAnswer: 'teacher'
            }
            // ... (hasta completar las 50 preguntas - puedes añadir más siguiendo el mismo formato)
        ];

        const questionsContainer = document.getElementById('questions-container');
        const quizForm = document.getElementById('quiz-form');
        const resultsContainer = document.getElementById('results-container');
        const correctAnswersSummary = document.getElementById('correct-answers-summary');
        const incorrectAnswersSummary = document.getElementById('incorrect-answers-summary');
        const totalQuestionsSummary = document.getElementById('total-questions-summary');
        const levelSummary = document.getElementById('level-summary');
        const resultsChartCanvas = document.getElementById('results-chart').getContext('2d');
        const motivationalMessageDiv = document.getElementById('motivational-message');
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const timerDisplay = document.getElementById('time-left');

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timeLeft = 300; // 5 minutos en segundos
        let timerInterval;

        // Niveles de inglés
        const levelMap = {
            5: 'A1.1', 10: 'A1.2', 15: 'A1.3', 20: 'B1.1', 25: 'B1.2', 30: 'B1.3', 35: 'C1.1', 40: 'C1.2', 45: 'C1.3', 50: 'D1.1'
        };

        function startTimer() {
            timerInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
                timeLeft--;
            }, 1000);
        }

        function loadQuestion() {
            if (currentQuestionIndex < questionsData.length) {
                const question = questionsData[currentQuestionIndex];
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question-container', 'mb-4');
                if (currentQuestionIndex === 0) {
                    questionDiv.classList.add('active');
                }
                questionDiv.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2">${currentQuestionIndex + 1}. ${question.question}</h3>
                `;

                if (question.type === 'image' && question.imageSrc) {
                    questionDiv.innerHTML += `<img src="${question.imageSrc}" alt="${question.question}" class="img-fluid mb-2 lazy-load" loading="lazy">`;
                } else if (question.type === 'audio' && question.audioSrc) {
                    questionDiv.innerHTML += `<audio src="${question.audioSrc}" controls class="mb-2"></audio>`;
                }

                const optionsList = document.createElement('div');
                question.options.forEach((option, index) => {
                    const inputId = `q${currentQuestionIndex}-option${index}`;
                    optionsList.innerHTML += `
                        <div class="form-check">
                            <input type="radio" class="form-check-input" name="q${currentQuestionIndex}" id="${inputId}" value="${option}" aria-label="${question.question} - Opción ${index + 1}">
                            <label class="form-check-label answer-option" for="${inputId}">${option}</label>
                        </div>
                    `;
                });
                questionDiv.appendChild(optionsList);

                questionsContainer.appendChild(questionDiv);
            } else {
                clearInterval(timerInterval);
                submitQuiz();
            }
        }

        function checkAnswer() {
            const selectedOption = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
            if (selectedOption) {
                userAnswers[currentQuestionIndex] = selectedOption.value;
                const currentQuestionDiv = document.querySelector(`#questions-container > div:nth-child(${currentQuestionIndex + 1})`);
                const labels = currentQuestionDiv.querySelectorAll('.answer-option');
                labels.forEach(label => {
                    const radio = label.previousElementSibling;
                    if (label.textContent === questionsData[currentQuestionIndex].correctAnswer) {
                        label.classList.add('feedback-correct');
                        if (radio.value === userAnswers[currentQuestionIndex]) {
                            // Optionally highlight the correct answer chosen by the user
                        }
                    } else if (radio.value === userAnswers[currentQuestionIndex] && label.textContent !== questionsData[currentQuestionIndex].correctAnswer) {
                        label.classList.add('feedback-incorrect');
                    }
                });

                setTimeout(() => {
                    currentQuestionIndex++;
                    const currentActive = document.querySelector('.question-container.active');
                    if (currentActive) {
                        currentActive.classList.remove('active');
                    }
                    if (currentQuestionIndex < questionsData.length) {
                        const nextQuestion = document.querySelector(`#questions-container > div:nth-child(${currentQuestionIndex + 1})`);
                        if (nextQuestion) {
                            nextQuestion.classList.add('active');
                        } else {
                            submitQuiz();
                        }
                    } else {
                        submitQuiz();
                    }
                }, 1000); // Show feedback for 1 second
            } else {
                alert('Por favor, selecciona una respuesta.');
            }
        }

        quizForm.addEventListener('submit', function(event) {
            event.preventDefault();
            clearInterval(timerInterval);
            submitQuiz();
        });

        function submitQuiz() {
            let correctCount = 0;
            questionsData.forEach((question, index) => {
                if (userAnswers[index] === question.correctAnswer) {
                    correctCount++;
                }
            });

            const incorrectCount = questionsData.length - correctCount;
            const level = getLevel(correctCount);

            totalQuestionsSummary.textContent = questionsData.length;
            correctAnswersSummary.textContent = correctCount;
            incorrectAnswersSummary.textContent = incorrectCount;
            levelSummary.textContent = level;

            displayMotivationalMessage(level);
            drawChart(correctCount, incorrectCount);

            document.getElementById('exam-container').style.display = 'none';
            resultsContainer.style.display = 'block';
            localStorage.setItem('quizResults', JSON.stringify({ correct: correctCount, incorrect: incorrectCount, level: level }));
        }

        function getLevel(score) {
            for (const threshold in levelMap) {
                if (score <= parseInt(threshold)) {
                    return levelMap[threshold];
                }
            }
            return 'N/A';
        }

        function displayMotivationalMessage(level) {
            let message = '';
            if (level.startsWith('A1')) {
                message = '¡Buen comienzo! Sigue practicando para mejorar.';
            } else if (level.startsWith('B1')) {
                message = '¡Progreso notable! Mantén tu esfuerzo y alcanzarás el siguiente nivel.';
            } else if (level.startsWith('C1')) {
                message = '¡Excelente dominio del inglés! Estás en un nivel avanzado.';
            } else if (level.startsWith('D1')) {
                message = '¡Impresionante! Tienes un nivel de inglés excepcional.';
            } else {
                message = 'Revisa tus respuestas y sigue aprendiendo.';
            }
            motivationalMessageDiv.textContent = message;
        }

        function drawChart(correct, incorrect) {
            new Chart(resultsChartCanvas, {
                type: 'pie',
                data: {
                    labels: ['Aciertos', 'Errores'],
                    datasets: [{
                        data: [correct, incorrect],
                        backgroundColor: ['#28a745', '#dc3545'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: getComputedStyle(document.body).color
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuad'
                    }
                }
            });

            gsap.from(resultsChartCanvas, { opacity: 0, duration: 1, ease: 'power2.out' });
        }

        function sendResultsViaEmail() {
            const fullName = document.getElementById('full-name').value;
            const email = document.getElementById('email').value;
            const subject = 'Resultados del Examen de Inglés';
            const body = `Hola ${fullName},\n\nAquí están los resultados de tu examen de inglés:\n\nAciertos: ${correctAnswersSummary.textContent}\nErrores: ${incorrectAnswersSummary.textContent}\nNivel: ${levelSummary.textContent}\n\n¡Gracias por participar!`;
            window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

            // **Implementación con Backend (Comentario):**
            // En un entorno real, podrías enviar estos datos a un servidor backend
            // usando una petición AJAX (fetch o XMLHttpRequest). El backend se encargaría
            // de enviar el correo electrónico utilizando una biblioteca de correo
            // (como Nodemailer en Node.js o Django Email en Python).
            //
            // Ejemplo de llamada fetch (solo ilustrativo):
            // fetch('/api/send-email', {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json'
            //     },
            //     body: JSON.stringify({ fullName, email, correct: parseInt(correctAnswersSummary.textContent), incorrect: parseInt(incorrectAnswersSummary.textContent), level: levelSummary.textContent })
            // })
            // .then(response => response.json())
            // .then(data => {
            //     if (data.success) {
            //         alert('Resultados enviados por correo electrónico.');
            //     } else {
            //         alert('Error al enviar el correo electrónico.');
            //     }
            // });
        }

        function downloadResultsCSV() {
            const fullName = document.getElementById('full-name').value;
            const email = document.getElementById('email').value;
            const csvData = [
                ['Nombre Completo', 'Correo Electrónico', 'Total Preguntas', 'Aciertos', 'Errores', 'Nivel'],
                [fullName, email, questionsData.length, correctAnswersSummary.textContent, incorrectAnswersSummary.textContent, levelSummary.textContent]
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvData], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resultados_examen.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function downloadChartPNG() {
            const link = document.createElement('a');
            link.download = 'grafico_resultados.png';
            link.href = resultsChartCanvas.toDataURL('image/png');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            themeIcon.classList.toggle('fa-sun', !isDark);
            themeIcon.classList.toggle('fa-moon', isDark);
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark');
            themeIcon.classList.add('fa-moon');
        }

        themeToggleBtn.addEventListener('click', toggleTheme);

        // Lazy loading observer
        const imgObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('loaded');
                    observer.unobserve(entry.target);
                }
            });
        });

        const images = document.querySelectorAll('.lazy-load');
        images.forEach(img => {
            imgObserver.observe(img);
        });

        // Cargar la primera pregunta y iniciar el temporizador
        loadQuestion();
        startTimer();

        // Navegación por teclado (básico)
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowRight') {
                const currentActive = document.querySelector('.question-container.active');
                if (currentActive) {
                    const nextSibling = currentActive.nextElementSibling;
                    if (nextSibling && nextSibling.classList.contains('question-container')) {
                        currentActive.classList.remove('active');
                        nextSibling.classList.add('active');
                        currentQuestionIndex = Array.from(questionsContainer.children).indexOf(nextSibling);
                    }
                }
            } else if (event.key === 'ArrowLeft') {
                const currentActive = document.querySelector('.question-container.active');
                if (currentActive) {
                    const previousSibling = currentActive.previousElementSibling;
                    if (previousSibling && previousSibling.classList.contains('question-container')) {
                        currentActive.classList.remove('active');
                        previousSibling.classList.add('active');
                        currentQuestionIndex = Array.from(questionsContainer.children).indexOf(previousSibling);
                    }
                }
            } else if (event.key === 'Enter') {
                const activeQuestion = document.querySelector('.question-container.active');
                if (activeQuestion) {
                    const focusedElement = document.activeElement;
                    if (focusedElement.type === 'radio') {
                        focusedElement.checked = true;
                    } else if (focusedElement.tagName === 'BUTTON' && focusedElement.id === 'submit-quiz') {
                        focusedElement.click();
                    }
                }
            }
        });
    </script>
</body>
</html>